# ✅ خطة عمل (TODO) - نظام الموارد البشرية (08)

---

## ⚠️ تحذير هام - القواعد الصارمة - اقرأ قبل البدء ⚠️

**قبل كتابة أي سطر كود، اقرأ والتزم بملف `docs/12_القواعد_الصارمة.md`.**

> **القاعدة الذهبية:** لا شاشة بدون Backend، لا بيانات وهمية، CRUD كامل، اختبار حقيقي.

**تسلسل البناء الإلزامي لكل مهمة:**

1.  **Prisma Schema** (إنشاء/تحديث الجداول)
2.  **Migration** (`npx prisma migrate dev`)
3.  **NestJS** (Service + Controller)
4.  **Postman/Swagger Test** (اختبار الـ API)
5.  **Angular Component** (بناء الشاشة)
6.  **ربط الشاشة بالـ API**
7.  **اختبار CRUD كامل ببيانات حقيقية**

**أي مهمة لا تتبع هذا التسلسل تعتبر غير مكتملة وسيتم رفضها.**

---

## المرحلة 1: إدارة الموظفين (Sprint 1)

-   **الهدف:** بناء الوحدات الأساسية لإدارة الموظفين والأقسام والمسميات الوظيفية.
-   **الالتزام:** كل شاشة يجب أن تكون متصلة بالـ Backend وتعرض بيانات حقيقية.

-   [ ] **1.1 إعداد Prisma Schema:**
    -   [ ] تحويل جداول SQL من `docs/08_نظام_الموارد_البشرية.md` إلى Prisma Schema.
    -   [ ] الجداول: `hr_employees`, `hr_employment_details`, `hr_departments`, `hr_positions`.
    -   [ ] إضافة البادئة `hr_` لجميع الجداول.
    -   [ ] **القاعدة الصارمة:** `uuid()` للمفاتيح الأساسية، `Decimal` للقيم المالية.

-   [ ] **1.2 تشغيل Migration:**
    -   [ ] `npx prisma migrate dev --name init-hr-schema`
    -   [ ] التحقق من إنشاء الجداول في PostgreSQL.

-   [ ] **1.3 بناء وحدة الموظفين (Core Employee Module):**
    -   [ ] بناء APIs لإدارة الموظفين (CRUD).
    -   [ ] بناء APIs لإدارة الأقسام (CRUD).
    -   [ ] بناء APIs لإدارة المسميات الوظيفية (CRUD).
    -   [ ] **القاعدة الصارمة:** اختبار جميع الـ APIs عبر Postman والتأكد من حفظ البيانات في قاعدة البيانات.

-   [ ] **1.4 بناء شاشة قائمة الموظفين:**
    -   [ ] إنشاء `EmployeesListComponent`.
    -   [ ] ربط الشاشة بـ API `GET /api/v1/employees`.
    -   [ ] عرض الموظفين في جدول PrimeNG (`p-table`) مع فلترة وبحث.
    -   [ ] **القاعدة الصارمة:** يجب أن تعرض الشاشة البيانات من قاعدة البيانات مباشرة.

-   [ ] **1.5 بناء شاشة ملف الموظف (عرض/تعديل/إنشاء):**
    -   [ ] إنشاء `EmployeeProfileComponent`.
    -   [ ] ربط الشاشة بـ APIs `GET`, `POST`, `PUT`.
    -   [ ] **القاعدة الصارمة:** عند إنشاء موظف جديد، يجب أن يظهر فوراً في قائمة الموظفين.

---

## المرحلة 2: الرواتب والمستحقات (Sprint 2 & 3)

-   **الهدف:** بناء محرك الرواتب، إدارة السلف والقروض.
-   **الالتزام:** كل عملية مالية يجب أن تُنشئ قيد محاسبي.

-   [ ] **2.1 بناء وحدة الرواتب الأساسية:**
    -   [ ] Prisma Schema: `hr_salary_grades`, `hr_salary_details`.
    -   [ ] بناء APIs لإدارة سلالم الرواتب وبيانات رواتب الموظفين.
    -   [ ] بناء شاشة لإدارة بيانات راتب الموظف.
    -   [ ] **القاعدة الصارمة:** يجب اتباع تسلسل البناء الإلزامي.

-   [ ] **2.2 بناء محرك مسير الرواتب (Payroll Engine):**
    -   [ ] Prisma Schema: `hr_payroll_runs`, `hr_payroll_details`.
    -   [ ] بناء `PayrollService` لحساب الرواتب (الاستحقاقات والخصومات).
    -   [ ] بناء API `POST /api/v1/payroll/calculate` لتشغيل الحسابات.
    -   [ ] **القاعدة الصارمة:** يجب أن تكون جميع الحسابات دقيقة وتستخدم نوع `Decimal`.

-   [ ] **2.3 بناء شاشة مسير الرواتب:**
    -   [ ] بناء شاشة لعرض مسيرات الرواتب وحالتها (مسودة، معتمدة، مدفوعة).
    -   [ ] بناء شاشة لعرض تفاصيل راتب كل موظف في المسير.
    -   [ ] إضافة دورة موافقات (Workflow) لاعتماد المسير.
    -   [ ] **القاعدة الصارمة:** لا يمكن تعديل مسير رواتب معتمد.

-   [ ] **2.4 بناء وحدة السلف والقروض:**
    -   [ ] Prisma Schema: `hr_employee_loans`.
    -   [ ] بناء APIs وشاشات لإدارة السلف والقروض.
    -   [ ] **القاعدة الصارمة:** يجب أن يتم خصم قسط السلفة تلقائياً من مسير الرواتب.

---

## المرحلة 3: الإجازات والحضور (Sprint 4)

-   **الهدف:** إدارة أرصدة الإجازات، طلبات الإجازة، وربطها بالحضور والرواتب.
-   **الالتزام:** كل طلب إجازة يجب أن يمر بدورة موافقات.

-   [ ] **3.1 بناء وحدة الإجازات:**
    -   [ ] Prisma Schema: `hr_leave_types`, `hr_employee_leave_balances`, `hr_leave_requests`.
    -   [ ] بناء APIs وشاشات لإدارة أنواع الإجازات وأرصدة الموظفين.
    -   [ ] بناء شاشة الخدمة الذاتية للموظف لتقديم طلب إجازة.
    -   [ ] بناء شاشة للمدير لمراجعة واعتماد طلبات الإجازة.
    -   [ ] **القاعدة الصارمة:** يجب تحديث رصيد إجازات الموظف بعد اعتماد الطلب.

-   [ ] **3.2 بناء وحدة الحضور والانصراف:**
    -   [ ] Prisma Schema: `hr_attendance_records`.
    -   [ ] بناء API لاستقبال بيانات الحضور من أجهزة البصمة.
    -   [ ] بناء شاشة لعرض سجلات الحضور للموظفين.
    -   [ ] **القاعدة الصارمة:** يجب أن تؤثر بيانات الحضور (الغياب، التأخير) على حساب مسير الرواتب.

---

## المرحلة 4: تقييم الأداء والتدريب (Sprint 5)

-   **الهدف:** بناء نظام تقييم الأداء وإدارة الدورات التدريبية.

-   [ ] **4.1 بناء وحدة تقييم الأداء:**
    -   [ ] Prisma Schema: `hr_evaluation_cycles`, `hr_evaluation_criteria`, `hr_employee_evaluations`, `hr_evaluation_details`, `hr_employee_goals`.
    -   [ ] بناء APIs وشاشات لإدارة دورات التقييم، المعايير، والأهداف.
    -   [ ] بناء شاشة التقييم (التقييم الذاتي وتقييم المدير).
    -   [ ] **القاعدة الصارمة:** يجب اتباع تسلسل البناء الإلزامي لكل شاشة.

-   [ ] **4.2 بناء وحدة التدريب:**
    -   [ ] Prisma Schema: `hr_training_courses`, `hr_training_sessions`, `hr_training_participants`.
    -   [ ] بناء APIs وشاشات لإدارة الدورات التدريبية والمشاركين.
    -   [ ] **القاعدة الصارمة:** يجب أن تكون جميع البيانات حقيقية ومحفوظة في قاعدة البيانات.

---

## المرحلة 5: الخدمة الذاتية والسلامة المهنية (Sprint 6)

-   **الهدف:** تمكين الموظفين من طلب العهد وتسجيل حوادث السلامة.

-   [ ] **5.1 بناء وحدة طلبات العهد:**
    -   [ ] Prisma Schema: `hr_custody_requests`, `hr_custody_request_approvals`.
    -   [ ] بناء APIs وشاشات الخدمة الذاتية لتقديم ومتابعة طلبات العهد.
    -   [ ] بناء دورة موافقات ديناميكية حسب نوع العهدة.
    -   [ ] **القاعدة الصارمة:** يجب أن يتكامل مع نظام المخزون والأصول والنظام المالي.

-   [ ] **5.2 بناء وحدة الصحة والسلامة المهنية:**
    -   [ ] Prisma Schema: `hr_incidents`, `hr_hazards`, `hr_medical_examinations`.
    -   [ ] بناء APIs وشاشات لتسجيل ومتابعة الحوادث والمخاطر.
    -   [ ] **القاعدة الصارمة:** يجب اتباع تسلسل البناء الإلزامي.

---

## ⚠️ تذكير نهائي ⚠️

**نجاح هذا النظام يعتمد على الالتزام الصارم بالقواعد. لا يوجد مجال للبيانات الوهمية أو الحلول المؤقتة.**
